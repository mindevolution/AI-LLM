# Function Calling å·¥ä½œåŸç†

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 1: ç”¨æˆ·æé—®                                            â”‚
â”‚  "å¤§è¿çš„å¤©æ°”æ€æ ·"                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 2: è°ƒç”¨æ¨¡å‹ï¼ˆä¼ å…¥å‡½æ•°æè¿°ï¼‰                            â”‚
â”‚  messages = [                                                â”‚
â”‚    {"role": "user", "content": "å¤§è¿çš„å¤©æ°”æ€æ ·"}            â”‚
â”‚  ]                                                           â”‚
â”‚  functions = [                                               â”‚
â”‚    {                                                         â”‚
â”‚      "name": "get_current_weather",                         â”‚
â”‚      "description": "Get the current weather...",           â”‚
â”‚      "parameters": {...}                                    â”‚
â”‚    }                                                         â”‚
â”‚  ]                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 3: æ¨¡å‹åˆ†æ                                            â”‚
â”‚  - ç†è§£ç”¨æˆ·æ„å›¾ï¼šéœ€è¦æŸ¥è¯¢å¤©æ°”                                â”‚
â”‚  - æŸ¥çœ‹å¯ç”¨å‡½æ•°ï¼šget_current_weather                         â”‚
â”‚  - å†³å®šï¼šéœ€è¦è°ƒç”¨å‡½æ•°                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 4: æ¨¡å‹è¿”å› function_call                              â”‚
â”‚  {                                                           â”‚
â”‚    "role": "assistant",                                     â”‚
â”‚    "function_call": {                                       â”‚
â”‚      "name": "get_current_weather",                        â”‚
â”‚      "arguments": '{"location": "å¤§è¿", "unit": "celsius"}' â”‚
â”‚    }                                                         â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 5: æ‰§è¡Œå‡½æ•°                                            â”‚
â”‚  get_current_weather(location="å¤§è¿", unit="celsius")        â”‚
â”‚  â†’ è¿”å›: '{"location": "å¤§è¿", "temperature": 11, ...}'     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 6: å°†å‡½æ•°ç»“æœåŠ å…¥å¯¹è¯å†å²                              â”‚
â”‚  messages.append({                                           â”‚
â”‚    "role": "function",                                      â”‚
â”‚    "name": "get_current_weather",                           â”‚
â”‚    "content": '{"location": "å¤§è¿", "temperature": 11}'     â”‚
â”‚  })                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 7: å†æ¬¡è°ƒç”¨æ¨¡å‹ï¼ˆåŒ…å«å‡½æ•°ç»“æœï¼‰                        â”‚
â”‚  messages = [                                                â”‚
â”‚    {"role": "user", "content": "å¤§è¿çš„å¤©æ°”æ€æ ·"},           â”‚
â”‚    {"role": "assistant", "function_call": {...}},           â”‚
â”‚    {"role": "function", "content": "å¤©æ°”æ•°æ®"}              â”‚
â”‚  ]                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 8: æ¨¡å‹ç”Ÿæˆæœ€ç»ˆå›ç­”                                    â”‚
â”‚  "å¤§è¿ä»Šå¤©çš„å¤©æ°”æ˜¯æ™´å¤©ï¼Œæ¸©åº¦11æ‘„æ°åº¦ï¼Œæœ‰å¾®é£ã€‚"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ å…³é”®ç»„ä»¶

### 1. å‡½æ•°å®šä¹‰ï¼ˆSchemaï¼‰
```python
functions = [
    {
        'name': 'get_current_weather',      # å‡½æ•°å
        'description': 'Get the current weather...',  # å‡½æ•°æè¿°
        'parameters': {                      # å‚æ•°å®šä¹‰
            'type': 'object',
            'properties': {
                'location': {
                    'type': 'string',
                    'description': 'The city name'
                }
            },
            'required': ['location']
        }
    }
]
```

### 2. æ¨¡å‹è°ƒç”¨
```python
response = dashscope.Generation.call(
    model='qwen-max',
    messages=messages,      # å¯¹è¯å†å²
    functions=functions,    # å‡½æ•°æè¿°ï¼ˆå…³é”®ï¼ï¼‰
    result_format='message'
)
```

### 3. æ£€æŸ¥å‡½æ•°è°ƒç”¨
```python
if hasattr(message, 'function_call') and message.function_call:
    function_call = message.function_call
    tool_name = function_call['name']  # å‡½æ•°å
    arguments = json.loads(function_call['arguments'])  # å‚æ•°
```

### 4. æ‰§è¡Œå‡½æ•°
```python
tool_response = get_current_weather(
    location=arguments.get('location'),
    unit=arguments.get('unit')
)
```

### 5. è¿”å›ç»“æœç»™æ¨¡å‹
```python
tool_info = {
    "role": "function",        # å¿…é¡»æ˜¯ "function"
    "name": tool_name,         # å‡½æ•°å
    "content": tool_response   # å‡½æ•°è¿”å›ç»“æœ
}
messages.append(tool_info)
```

## ğŸ”‘ å…³é”®ç‚¹

1. **å‡½æ•°æè¿°å¾ˆé‡è¦**ï¼šæ¨¡å‹æ ¹æ® `description` å†³å®šæ˜¯å¦è°ƒç”¨å‡½æ•°
2. **å¯¹è¯å†å²å¿…é¡»å®Œæ•´**ï¼šåŒ…å« user â†’ assistant â†’ function â†’ assistant
3. **å‚æ•°æ˜¯ JSON å­—ç¬¦ä¸²**ï¼šéœ€è¦ `json.loads()` è§£æ
4. **å‡½æ•°è¿”å›ç»“æœ**ï¼šå¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼ˆé€šå¸¸ç”¨ `json.dumps()`ï¼‰
5. **å¯ä»¥å¤šæ¬¡è°ƒç”¨**ï¼šæ¨¡å‹å¯ä»¥è¿ç»­è°ƒç”¨å¤šä¸ªå‡½æ•°

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

- æŸ¥è¯¢å®æ—¶æ•°æ®ï¼ˆå¤©æ°”ã€è‚¡ç¥¨ã€æ–°é—»ï¼‰
- æ‰§è¡Œæ“ä½œï¼ˆå‘é€é‚®ä»¶ã€åˆ›å»ºä»»åŠ¡ï¼‰
- è®¿é—®å¤–éƒ¨ API
- æ•°æ®åº“æŸ¥è¯¢
- è®¡ç®—å¤æ‚é—®é¢˜

